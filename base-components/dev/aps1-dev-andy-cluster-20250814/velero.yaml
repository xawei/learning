repoURL: https://vmware-tanzu.github.io/helm-charts
targetRevision: 10.0.10
namespace: velero
wave: "0"

helm:
  chart: velero

  # Map generic parameters (from the ApplicationSet generator values) to chart keys
  parameterOverrides:
    # S3 bucket used by Velero backups
    s3BucketName: 'configuration.backupStorageLocation[0].bucket'
    # Regions for backup and snapshot locations
    regionBackup: 'configuration.backupStorageLocation[0].config.region'
    regionSnapshot: 'configuration.volumeSnapshotLocation[0].config.region'
    # IRSA role annotation for the velero server service account (escape dots; slash is literal)
    roleArn: 'serviceAccount.server.annotations.eks\\.amazonaws\\.com/role-arn'

  values:
    # Keep CRD handling explicit to avoid conflicts
    installCRDs: false
    upgradeCRDs: false

    serviceAccount:
      server:
        create: true
        annotations: {}

    initContainers:
      - name: velero-plugin-for-aws
        image: velero/velero-plugin-for-aws:v1.5.0
        volumeMounts:
          - mountPath: /target
            name: plugins

    tolerations:
      - key: "karpenter.sh/nodepool"
        operator: "Equal"
        value: "infra"
        effect: "NoSchedule"

    configuration:
      backupStorageLocation:
        - name: default
          provider: aws
          # bucket will be set via parameterOverrides.s3BucketName
          config:
            # region will be overridden by parameterOverrides.regionBackup
            region: ap-southeast-1
      volumeSnapshotLocation:
        - name: default
          provider: aws
          config:
            # region will be overridden by parameterOverrides.regionSnapshot
            region: ap-southeast-1


