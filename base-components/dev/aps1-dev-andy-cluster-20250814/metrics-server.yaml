repoURL: https://kubernetes-sigs.github.io/metrics-server/
targetRevision: 3.12.1
namespace: kube-system
wave: "0"

helm:
  chart: metrics-server
  values:
    # Enable metrics-server for HPA and kubectl top commands
    args:
      - --cert-dir=/tmp 
      - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
      - --kubelet-use-node-status-port
      - --metric-resolution=15s
      - --kubelet-insecure-tls
    
    # Resource requests and limits
    resources:
      requests:
        cpu: 100m
        memory: 200Mi
      limits:
        cpu: 1000m
        memory: 1000Mi
    
    tolerations:
      - key: "karpenter.sh/nodepool"
        operator: "Equal"
        value: "infra"
        effect: "NoSchedule"
    
    # Security context
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 1000
      seccompProfile:
        type: RuntimeDefault
      capabilities:
        drop:
          - ALL
    
    # Service configuration
    service:
      type: ClusterIP
      port: 443
    
    # Deployment configuration
    replicas: 1